# Pro100 Gym - Документация для Backend

Этот документ содержит основную информацию для разработчиков фронтенда по работе с бэкенд-сервисом приложения Pro100 Gym.

## 1. Обзор и документация API

Бэкенд предоставляет API для управления пользователями, их предпочтениями и генерации персонализированных планов тренировок.

**Полная интерактивная документация API (Swagger UI) доступна по адресу:**

[http://localhost:8000/docs#/](http://localhost:8000/docs#/)

Рекомендуется использовать эту документацию для изучения всех доступных эндпоинтов, их параметров и моделей данных.

## 2. Аутентификация

В приложении используется аутентификация на основе JWT (JSON Web Token). Чтобы получить доступ к защищенным эндпоинтам, необходимо получить токен и использовать его в заголовках последующих запросов.

### Шаг 1: Получение токена

Для получения токена необходимо отправить `POST` запрос на эндпоинт `/auth/login` с `username` и `password` в теле запроса (в формате `x-www-form-urlencoded`).
В ответ вы получите `access_token`.

**Авторизация в Swagger UI:**
В Swagger (`http://localhost:8000/docs#/`) для удобства тестирования можно использовать специальный эндпоинт. Нажмите на кнопку **"Authorize"** в правом верхнем углу, введите `username` и `password`, и Swagger автоматически получит токен и будет подставлять его во все запросы.

### Шаг 2: Использование токена

Для аутентификации на защищенных эндпоинтах (например, `GET /users/me`) необходимо передавать полученный токен в заголовке `Authorization`.

**Пример заголовка:**
```
Authorization: Bearer <ваш_access_token>
```

## 3. Основные сценарии работы

### 3.1. Профиль пользователя

- **Получение данных профиля:** `GET /users/me`
- **Обновление данных профиля:** `PATCH /users/me`
  - Этот эндпоинт позволяет частично обновлять данные пользователя, такие как `weight`, `height`, `age`, `fitness_goal` и т.д.

### 3.2. Предпочтения и ограничения

Это ключевая часть для персонализации тренировок.

1.  **Получение доступных опций:**
    - `GET /options/restriction-rules`: Получить список всех возможных ограничений по здоровью (например, "больные колени").
    - `GET /options/muscle-focuses`: Получить список всех доступных "акцентов" на группы мышц (например, "акцент на грудь" или "не хочу качать ноги").

2.  **Управление предпочтениями пользователя:**
    - `GET /preferences/me`: Получить текущие установленные предпочтения пользователя.
    - `PUT /preferences/me`: Установить или обновить предпочтения пользователя. В теле запроса передаются **списки идентификаторов (`id`)** выбранных опций.

    **Пример тела запроса для `PUT /preferences/me`:**
    ```json
    {
      "restriction_rule_ids": [1, 3],
      "muscle_focus_ids": [2, 5]
    }
    ```

### 3.3. План тренировок

- **Генерация нового плана:** `POST /workouts/generate`
  - Сервер сгенерирует новый план на основе данных профиля и предпочтений пользователя. Если у пользователя уже есть план, он будет **перезаписан**.
- **Получение текущего плана:** `GET /workouts/`
  - Возвращает текущий активный план тренировок.
- **Удаление плана:** `DELETE /workouts/`
  - Удаляет текущий план пользователя.

### 3.4. Интерактивная тренировка (сессии)

Этот набор эндпоинтов позволяет управлять активной тренировочной сессией: начинать ее, отслеживать прогресс по каждому подходу и завершать.

1.  **Начало тренировки:**
    - `POST /sessions/start`
      - **Действие:** Запускает новую тренировочную сессию для определенного дня из вашего плана.
      - **Тело запроса:**
        ```json
        {
          "workout_plan_id": 1,
          "day_index": 0
        }
        ```
      - В ответ вы получите полную структуру активной сессии, включая все упражнения и подходы со статусом `pending`.

2.  **Получение активной тренировки:**
    - `GET /sessions/active`
      - **Действие:** Если у вас есть незавершенная тренировка, этот эндпоинт вернет ее текущее состояние. Это полезно для восстановления состояния в приложении после перезагрузки.

3.  **Выполнение подхода:**
    - `POST /sessions/sets/{set_id}/complete`
      - **Действие:** Отмечает один подход (`set`) как выполненный и сохраняет ваш результат.
      - **`{set_id}`:** ID подхода, который вы берете из ответа `GET /sessions/active`.
      - **Тело запроса:**
        ```json
        {
          "reps_done": 10,
          "weight_lifted": 52.5
        }
        ```
    - `POST /sessions/sets/{set_id}/skip`
      - **Действие:** Позволяет пропустить подход.

4.  **Завершение/Отмена тренировки:**
    - `POST /sessions/{session_id}/finish`
      - **Действие:** Завершает всю тренировочную сессию.
    - `POST /sessions/{session_id}/cancel`
      - **Действие:** Отменяет и полностью удаляет текущую сессию.

### 3.5. Статистика пользователя

Этот эндпоинт предоставляет агрегированную статистику по завершенным тренировкам пользователя.

- `GET /statistics/me`
  - **Действие:** Возвращает сводку по тренировкам, персональные рекорды, объем по группам мышц и данные для графиков прогресса.
  - **Параметры запроса (Query Parameters):**
    - `period: str` (Необязательный): Фильтрует статистику по времени. Допустимые значения: `all_time` (по умолчанию), `last_month`, `last_week`.
  - **Пример ответа:** (будет соответствовать `StatisticsResponse` схеме)
    ```json
    {
      "summary": {
        "total_workouts": 25,
        "total_duration_minutes": 1500,
        "total_volume_kg": 125000.5,
        "total_sets": 750,
        "total_reps": 7500,
        "personal_records": [
          {
            "exercise_name": "Жим лежа",
            "max_weight_kg": 100.0,
            "reps": 5,
            "date": "2025-12-10T10:00:00Z"
          }
        ]
      },
      "volume_by_muscle_group": [
        { "muscle_group": "Грудь", "volume_kg": 30000.0 },
        { "muscle_group": "Спина", "volume_kg": 28000.0 }
      ],
      "progress_charts": {
        "overall_volume": [
          { "date": "2025-11-01", "value_kg": 10000.0 },
          { "date": "2025-12-01", "value_kg": 12000.0 }
        ]
      }
    }
    ```
